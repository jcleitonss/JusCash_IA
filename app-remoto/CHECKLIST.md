# ‚úÖ Checklist de Deploy AWS

---

## üìã Pr√©-Deploy

### **AWS Account**
- [ ] Conta AWS criada
- [ ] AWS CLI instalado e configurado (`aws configure`)
- [ ] Credenciais com permiss√µes adequadas
- [ ] Regi√£o definida (us-east-1)

### **Ferramentas**
- [ ] Terraform instalado (`terraform --version`)
- [ ] Docker instalado e rodando (`docker --version`)
- [ ] Node.js 18+ instalado (`node --version`)
- [ ] Git configurado

### **Custos**
- [ ] Billing alerts configurados
- [ ] Budget definido (~$50/m√™s)
- [ ] Entendimento dos custos AWS

---

## üèóÔ∏è Deploy Infraestrutura

### **1. Backend S3 (State)**
- [ ] Criar bucket: `aws s3 mb s3://juscrash-terraform-state`
- [ ] Habilitar versionamento
- [ ] Confirmar bucket criado: `aws s3 ls | grep terraform`

### **2. Terraform Init**
```bash
cd app-remoto/infrastructure
terraform init
```
- [ ] Backend inicializado
- [ ] Providers baixados
- [ ] Sem erros

### **3. Terraform Plan**
```bash
terraform plan
```
- [ ] Revisar recursos a serem criados
- [ ] Confirmar custos estimados
- [ ] Sem erros de valida√ß√£o

### **4. Terraform Apply**
```bash
terraform apply
```
- [ ] Confirmar com `yes`
- [ ] Aguardar conclus√£o (~15-20 min)
- [ ] Copiar outputs:
  - [ ] `ecr_repository_url`
  - [ ] `api_url`
  - [ ] `frontend_url`
  - [ ] `cloudfront_distribution_id`

### **5. Validar Recursos**
```bash
# Lambda
aws lambda get-function --function-name juscrash-agent-core

# ECR
aws ecr describe-repositories --repository-names juscrash-agent-core

# S3
aws s3 ls | grep juscrash

# CloudFront
aws cloudfront list-distributions
```
- [ ] Lambda criado (sem c√≥digo ainda)
- [ ] ECR repository criado
- [ ] S3 buckets criados (frontend + flows)
- [ ] CloudFront distribution criado

---

## ü§ñ Deploy Backend (Lambda)

### **1. Build Docker**
```bash
cd ../agent-core
docker build -t juscrash-agent-core .
```
- [ ] Build sem erros
- [ ] Imagem criada

### **2. Login ECR**
```bash
aws ecr get-login-password --region us-east-1 | \
  docker login --username AWS --password-stdin <ACCOUNT_ID>.dkr.ecr.us-east-1.amazonaws.com
```
- [ ] Login successful

### **3. Push Imagem**
```bash
./deploy.sh
```
- [ ] Imagem tagged
- [ ] Push para ECR conclu√≠do
- [ ] Lambda atualizado

### **4. Testar Lambda**
```bash
# Health check
curl <API_URL>/health

# Verificar processo
curl -X POST <API_URL>/api/v1/verificar \
  -H "Content-Type: application/json" \
  -d @test_processo.json
```
- [ ] Health check retorna 200
- [ ] API processa requisi√ß√£o
- [ ] Resposta JSON v√°lida

### **5. Verificar Logs**
```bash
aws logs tail /aws/lambda/juscrash-agent-core --follow
```
- [ ] Logs aparecem
- [ ] Sem erros cr√≠ticos
- [ ] Bedrock respondendo

---

## üé® Deploy Frontend

### **1. Configurar Vari√°veis**
```bash
cd ../../app-local/frontend
echo "VITE_API_URL=<API_URL>" > .env.production
```
- [ ] `.env.production` criado
- [ ] API_URL correto

### **2. Build React**
```bash
npm ci
npm run build
```
- [ ] Build sem erros
- [ ] Pasta `dist/` criada

### **3. Sync S3**
```bash
aws s3 sync dist/ s3://juscrash-frontend/ --delete
```
- [ ] Arquivos enviados
- [ ] Sem erros

### **4. Invalidar CloudFront**
```bash
aws cloudfront create-invalidation \
  --distribution-id <CLOUDFRONT_ID> \
  --paths "/*"
```
- [ ] Invalida√ß√£o criada
- [ ] Aguardar conclus√£o (~5 min)

### **5. Testar Frontend**
- [ ] Acessar `<CLOUDFRONT_URL>`
- [ ] P√°gina carrega
- [ ] Formul√°rio aparece
- [ ] Consegue enviar requisi√ß√£o
- [ ] Resposta aparece

---

## üîÑ CI/CD (Opcional)

### **1. GitHub Secrets**
Adicionar no reposit√≥rio:
- [ ] `AWS_ACCESS_KEY_ID`
- [ ] `AWS_SECRET_ACCESS_KEY`
- [ ] `VITE_API_URL`
- [ ] `CLOUDFRONT_DISTRIBUTION_ID`

### **2. Testar Workflow**
```bash
git add .
git commit -m "test: CI/CD"
git push origin main
```
- [ ] GitHub Actions executou
- [ ] Deploy backend OK
- [ ] Deploy frontend OK
- [ ] Sem erros

---

## üìä Monitoramento

### **1. CloudWatch**
- [ ] Logs do Lambda vis√≠veis
- [ ] Logs do API Gateway vis√≠veis
- [ ] M√©tricas aparecendo

### **2. Custos**
- [ ] Cost Explorer configurado
- [ ] Alertas de billing ativos
- [ ] Monitorar primeiros dias

---

## üß™ Testes Finais

### **API**
- [ ] Health check funciona
- [ ] POST /api/v1/verificar funciona
- [ ] Erros retornam 4xx/5xx apropriados
- [ ] CORS configurado

### **Frontend**
- [ ] P√°gina carrega r√°pido (<2s)
- [ ] Formul√°rio funciona
- [ ] Resposta aparece
- [ ] Erros s√£o tratados

### **Integra√ß√£o**
- [ ] Frontend ‚Üí API Gateway ‚Üí Lambda ‚Üí Bedrock
- [ ] Fluxo completo funciona
- [ ] Lat√™ncia aceit√°vel (<5s)

---

## üêõ Troubleshooting

### **Lambda n√£o responde**
- [ ] Verificar logs CloudWatch
- [ ] Verificar IAM permissions
- [ ] Verificar timeout (60s)
- [ ] Verificar mem√≥ria (1024 MB)

### **Bedrock erro**
- [ ] Verificar IAM role tem `bedrock:InvokeModel`
- [ ] Verificar regi√£o (us-east-1)
- [ ] Verificar model ID correto

### **Frontend n√£o carrega**
- [ ] Verificar S3 bucket policy
- [ ] Verificar CloudFront OAI
- [ ] Invalidar cache CloudFront
- [ ] Verificar CORS

---

## ‚úÖ Deploy Completo!

Quando todos os itens estiverem marcados:

üéâ **Sistema no ar!**

**URLs:**
- Frontend: `https://xxxxx.cloudfront.net`
- API: `https://xxxxx.execute-api.us-east-1.amazonaws.com/prod`

---

## üìö Pr√≥ximos Passos

- [ ] Adicionar LangSmith (observabilidade)
- [ ] Configurar custom domain
- [ ] Adicionar WAF (seguran√ßa)
- [ ] Implementar cache DynamoDB
- [ ] Adicionar mais flows
- [ ] Documentar APIs (Swagger)
